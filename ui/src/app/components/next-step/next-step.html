<div class="next-step">
  <div class="step-header">
    <h2>{{ pasoActual() }}</h2>
    <p class="patient-id">Paciente ID: {{ patientID() }}</p>
  </div>

  @if (isLoading()) {
    <div class="loading-message">
      <strong>⏳ Cargando...</strong>
    </div>
  }

  @if (error()) {
    <div class="error-message">
      {{ error() }}
    </div>
  }

  <!-- Show previous selections -->
  @if (previousSelections().length > 0) {
    <div class="previous-selections">
      <h3>Selecciones anteriores:</h3>
      <div class="selection-list">
        @for (selection of previousSelections(); track $index) {
          @if (selection.checked) {
            <span class="selection-badge">{{ selection.label }}</span>
          }
        }
      </div>
    </div>
  }

  <!-- Current options form -->
  @if (hasData()) {
    <form (ngSubmit)="onSubmit()">
      <div class="options-group">
        <h3>Seleccione las opciones aplicables:</h3>
        
        <div class="checkbox-list">
          @for (option of opciones(); track option.label; let i = $index) {
            <label class="checkbox-item">
              <input
                type="checkbox"
                [checked]="option.checked"
                (change)="toggleOption(i)"
                [disabled]="isLoading()"
              />
              <span>{{ option.label }}</span>
            </label>
          }
        </div>
      </div>

      <div class="form-group">
        <label for="additional">Información adicional (opcional):</label>
        <textarea
          id="additional"
          [value]="additional()"
          (input)="updateAdditional($any($event.target).value)"
          placeholder="Ingrese información adicional si es necesario..."
          rows="3"
          [disabled]="isLoading()"
        ></textarea>
      </div>

      <button 
        type="submit" 
        [disabled]="isLoading()"
        class="submit-button"
      >
        @if (isLoading()) {
          <span>Enviando...</span>
        } @else {
          <span>Enviar</span>
        }
      </button>
    </form>
  }
</div>
